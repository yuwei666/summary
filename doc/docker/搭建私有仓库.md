### 不带验证部署

1. 拉取镜像

```bash
docker pull registry:2
```

2. 启动容器

```bash
docker run -d \
  -p 5000:5000 \
  --name my-registry \
  --restart always \
  -v /opt/registry:/var/lib/registry \
  registry:2
```

3. 验证

```bash
curl http://localhost:5000/v2/_catalog
```

正常响应：`{"repositories":[]}`（空仓库）。



### 基础验证部署（用户名/密码）

1. 拉取镜像

2. 使用 `httpd` 或 `apache2-utils` 容器创建认证文件

   ```bash
   # 创建一个文件夹
   mkdir -p auth
   
   # 创建一个临时容器来生成密码文件
   docker run --rm \
     httpd:alpine \
     htpasswd username password > auth/htpasswd
   ```

3. 启动带认证的 Registry

   `$(pwd)` 代表当前路径，所以密钥存放位置要选择好

```bash
docker run -d \
  -p 5000:5000 \
  --name registry \
  --restart always \
  -v /opt/registry:/var/lib/registry \
  -v /auth:/auth \
  -e "REGISTRY_AUTH=htpasswd" \
  -e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \
  -e "REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd" \
  registry:2
```

4. **启动带认证的 Registry**：

```bash
# 验证
curl -u username:password http://localhost:5000/v2/_catalog
```



### HTTPS加密（生产环境）

待补充

```bash
mkdir -p certs
openssl req -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key \
  -x509 -days 365 -out certs/domain.crt \
  -subj "/CN=myregistry.example.com" \
  -addext "subjectAltName=DNS:myregistry.example.com,DNS:localhost,IP:192.168.1.100"
```



#### 









